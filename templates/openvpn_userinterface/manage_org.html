{% extends "base/base.html" %}
{% load ovpn_tags %}
{% comment %}
encoding: utf-8
vim: shiftwidth=2 expandtab
{% endcomment %}
{% block content %}
<h1>{{ org.name }}</h1>

<h2>Networks</h2>
<p>This organization has access to the following networks:</p>

<ul>
  {% with org.accessible_network_set.all as networks %}
    {% for network in org.accessible_network_set.all %}
      <li>
        {% if client.is_superuser %}
          <form class="inline_form" action="{% url remove_network_from_org_page org_id=org.id network_id=network.id %}" method="post">
            <input type="submit" value="Remove" />
          </form>
        {% endif %}
        {% manage_link network client %}
      </li>
    {% endfor %}
    <li class="add_remove">
      {% if not networks %}
        No networks at the moment.
      {% endif %}
      <a href="{% url add_network_to_org_page org_id=org.id %}">Add a network...</a>
    </li>
    
  {% endwith %}
</ul>

<h2>Administrators</h2>
<p>
  This section lists the groups and users that have administrative rights
  in this organization.
<p>
{% if external_auth %}
  <p>
    Note that the administrative capabilities of a user are updated from
    Shibboleth when he logs in. They cannot be managed from this page while
    the service is linked into an external authentication service.
  </p>
{% endif %}

<ul>
  {% for admin_group in org.admin_group_set.all %}
    <li>
      {% if client.is_superuser %}
        <form class="inline_form" action="{% url remove_admin_group_from_org_page org_id=org.id admin_group_id=admin_group.id %}" method="post">
          <input type="submit" value="Remove" />
        </form>
      {% endif %}
      {% manage_link admin_group client %}
      <ul>
        {% for admin in admin_group.group.user_set.all %}
          <li>
            {% if client.is_superuser and not external_auth %}
              <form class="inline_form" action="{% remove_client_link user admin_group %}" method="post">
                <input type="submit" value="Remove" />
              </form>
            {% endif %}
            {% manage_client_link admin %}
          </li>
        {% endfor %}
        {% if client.is_superuser and not external_auth %}
          <li class="add_remove"><a href="{% url add_client_to_admin_group_page admin_group_id=admin_group.id %}">Add administrators to this group...</a></li>
        {% endif %}
      </ul>
    </li>
  {% endfor %}
  {% if client.is_superuser %}
    <li class="add_remove"><a href="{% url add_admin_group_to_org_page org_id=org.id %}">Add administrator groups to this organization...</a></li>
  {% endif %}
</ul>

<h2>Clients</h2>
<p>This section lists the users that are members of this organization.</p>
{% if external_auth %}
  <p>
    Note that the membership of a user is updated from Shibboleth each time
    he logs in. Organization membership cannot be managed from this view while
    the service is linked into an external authentication service.
  </p>
{% endif %}

<ul>
  {% for user in org.group.user_set.all %}
    <li>
      {% if not external_auth %}
        <form class="inline_form" action="{% remove_client_link user org %}" method="post">
          <input type="submit" value="Remove" />
        </form>
      {% endif %}
      {% manage_client_link user %}
    </li>
  {% endfor %}
  {% if not external_auth %}
    <li class="add_remove"><a href="{% url add_client_to_org_page org_id=org.id %}">Add clients to this organization...</a></li>
  {% endif %}
</ul>

{% endblock content %}

